@using FSH.Starter.Blazor.Modules.BlazorOS.Models
@using Microsoft.JSInterop;
@using System.Diagnostics.CodeAnalysis
@implements IDisposable
@inject IJSRuntime JSRuntime

@* <MudGrid Style="padding:2rem;width:100vw;height:100vh;margin:0;background-image: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);">
  @foreach (Shortcut item in _shortcuts)
  {
    <MudItem>
      <BosShell Shortcut="item"></BosShell>
    </MudItem>
  }
</MudGrid> *@
<div class="container" style="padding:2rem;background-image: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);">

    @foreach (Shortcut item in _shortcuts)
    {
        <MudItem Class="item">
            <BosShell Shortcut="item"></BosShell>
        </MudItem>
    }
    <div style="width: 200px; height:50px; position:absolute; top:0; left:0; background-color: crimson; color:white">
        width: @_viewSize?.width, Height: @_viewSize?.height
    </div>
</div>
@code {
    //!         public ValueTask<TValue> InvokeAsync<[DynamicallyAccessedMembers(DynamicallyAccessedMemberTypes.PublicConstructors | DynamicallyAccessedMemberTypes.PublicFields | DynamicallyAccessedMemberTypes.PublicProperties)] TValue>(string identifier, object?[]? args);
    public async ValueTask<TValue> LoadApp<[DynamicallyAccessedMembers(DynamicallyAccessedMemberTypes.PublicConstructors | DynamicallyAccessedMemberTypes.PublicFields | DynamicallyAccessedMemberTypes.PublicProperties)] TValue>(string identifier, object?[]? args)
    {
        return await JSRuntime.InvokeAsync<TValue>("helpers.launchApp", identifier, args);
    }
    record ViewSize(int height, int width);
    ViewSize _viewSize;
    private DotNetObjectReference<BosDesktop3>? objRef;
    protected override async Task OnInitializedAsync()
    {
        await LoadApp<BosDesktop3>("", []);
        _viewSize = await JSRuntime.InvokeAsync<ViewSize>("helpers.getWindowDimensions", []);
        await base.OnInitializedAsync();
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        // var width = await JSRuntime.InvokeAsync<int>("eval", "'window.innerWidth'");

        if (firstRender)
        {
            objRef = DotNetObjectReference.Create(this);
            await JSRuntime.InvokeVoidAsync("helpers.registerResizeCallback", objRef);
        }
    }

    static string imgSrc(string ext) => $"{Constants._content.Replace(Constants.ModuleName, "Document.Blazor")}/img/extensions/document/{ext}.png";
    // static string imgSrc = $"//plachold.it/80";

    List<Shortcut> _shortcuts = new List<Shortcut>
    {
        new Shortcut("Shell", "", imgSrc("txt"), $"{Constants._content}/files/shells/WindowsPowerShell.lnk"),
        new Shortcut("Notepad", "", imgSrc("pdf"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("Calculator", "", imgSrc("docx"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("File Explorer", "", imgSrc("txt"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("Command Prompt Command Prompt", "", imgSrc("txt"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("Settings", "", imgSrc("pdf"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("Task Manager", "", imgSrc("doc"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("Command PromptCommand Prompt", "", imgSrc("xls"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("Control Panel", "", imgSrc("xlsx"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("Paint", "", imgSrc("doc"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("WordPad", "", imgSrc("txt"), $"{Constants._content}/files/shells/Notepad.lnk"),
        new Shortcut("Command Prompt", "", imgSrc("txt"), $"{Constants._content}/files/shells/Notepad.lnk"),
    };




    [JSInvokable]
    public void OnBrowserResize(int width, int height)
    {
        _viewSize = new ViewSize(height, width);
        StateHasChanged();
    }

    public void Dispose() => objRef?.Dispose();

    private Type? selectedType;
    private Dictionary<string, object>? componentParameters;

    private void LoadComponentA(object component)
    {
        selectedType = component.GetType();
        componentParameters = new Dictionary<string, object>
        {
            { "Message", "Hello from A" }
        };
    }

    private void LoadComponentB()
    {
        // Example with string-based type loading if necessary
        selectedType = Type.GetType("YourNamespace.Components.ComponentB");
        componentParameters = new Dictionary<string, object>
        {
            { "Items", new List<string> { "One", "Two" } }
        };
    }
}

<style>
    .container {
        /* Minimum width for each column */
        column-width: 80px;
        /* Still fill sequentially */
        column-fill: auto; /* balance for newspaper style */
        /* Mandatory for the "top-to-bottom" effect */
        height: 100vh;
        padding-bottom: 60px;
        /* Adds a vertical line between columns for better readability */
        column-rule: 1px solid #ddd;
        column-gap: 10px;
    }

        .container .item {
            /* Prevents a child element from splitting across columns */
            break-inside: avoid;
            cursor: pointer;
            padding-block: 8px;
            padding-inline: 0 !important;
            border: 2px solid transparent;
            transition: border-color 0.3s;
            text-align: center;
            height: auto;
        }

            .container .item:hover {
                border-radius: 5px;
                border-color: var(--mud-palette-primary);
                background-color: var(--mud-palette-secondary-lighten-5);
                border-color: @Color.Primary;
                background-color: @Colors.Blue.Lighten2;
            }

            .container .item.selected {
                border-color: var(--mud-palette-secondary);
                background-color: var(--mud-palette-secondary-lighten-5);
            }

</style>
